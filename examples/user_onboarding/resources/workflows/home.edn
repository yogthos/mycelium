{:id :home
 :doc "Home page: check cookie session, show dashboard if logged in or login form if not"

 :input-schema [:map [:http-request [:map]]]

 :fragments
 {:auth {:ref   "fragments/cookie-auth.edn"
         :as    :start
         :exits {:success :render-dashboard
                 :failure :render-login}}}

 :cells
 {:render-dashboard
  {:id       :ui/render-dashboard
   :doc      "Render the dashboard page with user profile"
   :schema   {:input  [:map
                        [:profile [:map
                          [:name :string]
                          [:email :string]]]]
              :output [:map
                        [:html :string]]}
   :on-error :render-login
   :requires []}

  :render-login
  {:id       :ui/render-login-page
   :doc      "Render the login form page"
   :schema   {:input  [:map]
              :output [:map
                        [:html :string]]}
   :on-error nil
   :requires []}}

 :edges
 {:render-dashboard {:done :end}
  :render-login     {:done :end}}

 :dispatches
 {:render-dashboard [[:done (fn [_] true)]]
  :render-login     [[:done (fn [_] true)]]}}
